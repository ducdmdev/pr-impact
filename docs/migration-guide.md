# Migrating from pr-impact v0.x to v1.0

v1.0 is a complete architecture rewrite. Deterministic analysis is replaced by an AI agent that uses tool calls to gather evidence and produce reports.

## Package Changes

| v0.x Package | v1.0 Replacement | Action Required |
|---|---|---|
| `@pr-impact/core` | `@pr-impact/tools-core` | Update imports (see below) |
| `@pr-impact/cli` | `@pr-impact/action` + `@pr-impact/skill` | Remove CLI usage, switch to GitHub Action or Claude Code plugin |
| `@pr-impact/mcp-server` | `@pr-impact/tools` | Update MCP config (tool names changed) |

## Migrating from `@pr-impact/core`

### If you used `analyzePR()` programmatically

The `analyzePR()` orchestrator no longer exists. In v1.0, analysis is performed by Claude via tool calls. You have two options:

**Option A: Use the GitHub Action** (recommended for CI)

```yaml
- uses: ducdmdev/pr-impact@v1
  with:
    anthropic-api-key: ${{ secrets.ANTHROPIC_API_KEY }}
```

**Option B: Use individual tool functions**

```typescript
// v0.x
import { analyzePR } from '@pr-impact/core';
const report = await analyzePR({ repoPath: '.', base: 'main', head: 'feature' });

// v1.0
import { listChangedFiles, gitDiff, findImporters } from '@pr-impact/tools-core';
const files = await listChangedFiles({ base: 'main', head: 'feature' });
const diff = await gitDiff({ base: 'main', head: 'feature', file: 'src/index.ts' });
const consumers = await findImporters({ modulePath: 'src/utils.ts' });
// Analysis logic is now in the AI agent's system prompt, not in code
```

### If you used individual analysis functions

| v0.x Function | v1.0 Equivalent |
|---|---|
| `parseDiff()` | `listChangedFiles()` + `gitDiff()` |
| `detectBreakingChanges()` | Use `readFileAtRef()` to compare exports manually, or let the AI agent handle it |
| `checkTestCoverage()` | `listTestFiles()` |
| `checkStaleDocs()` | `searchCode()` to find references |
| `buildImpactGraph()` | `findImporters()` |
| `calculateRisk()` | Risk scoring is now in the AI agent's system prompt |
| `formatMarkdown()` / `formatJSON()` | Report formatting is in the AI agent's report template |

## Migrating from `@pr-impact/cli`

The `pri` CLI has been removed. Replace with:

| CLI Command | v1.0 Alternative |
|---|---|
| `pri analyze` | GitHub Action or Claude Code `/pr-impact` |
| `pri breaking` | `readFileAtRef()` to compare exports |
| `pri impact` | `findImporters()` from `@pr-impact/tools-core` |
| `pri risk` | GitHub Action outputs `risk-score` and `risk-level` |
| `pri comment` | GitHub Action with `github-token` input |

### CI migration

```yaml
# v0.x
- run: npx pri analyze --base main --threshold 75

# v1.0
- uses: ducdmdev/pr-impact@v1
  with:
    anthropic-api-key: ${{ secrets.ANTHROPIC_API_KEY }}
    threshold: '75'
```

## Migrating from `@pr-impact/mcp-server`

### MCP tool name changes

| v0.x Tool | v1.0 Tool |
|---|---|
| `analyze_diff` | No direct equivalent -- use `git_diff` + `list_changed_files` |
| `get_breaking_changes` | No direct equivalent -- use `read_file_at_ref` to compare exports |
| `get_impact_graph` | `find_importers` |
| `get_risk_score` | No direct equivalent -- risk scoring is in the AI prompt |
| *(new)* | `git_diff` -- raw diff between two refs |
| *(new)* | `read_file_at_ref` -- read file at a git ref |
| *(new)* | `list_changed_files` -- list changed files with stats |
| *(new)* | `search_code` -- regex search via git grep |
| *(new)* | `list_test_files` -- find test files for a source file |

### MCP config migration

```jsonc
// v0.x
{
  "mcpServers": {
    "pr-impact": {
      "command": "npx",
      "args": ["-y", "@pr-impact/mcp-server"]
    }
  }
}

// v1.0
{
  "mcpServers": {
    "pr-impact": {
      "command": "npx",
      "args": ["-y", "@pr-impact/tools"]
    }
  }
}
```

## Key Differences

| Aspect | v0.x | v1.0 |
|---|---|---|
| Analysis engine | Deterministic code (regex parsing, AST-free) | AI agent (Claude via Anthropic API) |
| Breaking change detection | Regex-based export diffing | Claude reads both versions and compares |
| Risk scoring | Computed in code (`risk-calculator.ts`) | Claude computes using the system prompt formula |
| Report format | Generated by `markdown-reporter.ts` | Claude follows a report template |
| Consistency | Identical results every run | May vary slightly between runs |
| Cost | Free (local computation) | Requires Anthropic API key (API usage costs) |
| Depth | Fixed analysis rules | Context-aware, can reason about intent |
